<!doctype html>
<html lang="es">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Login</title>
    <link rel="stylesheet" href="./app.css">
</head>

<body class="login-page">
    <main class="login-card" role="main" aria-labelledby="login-heading">
        <div class="brand" aria-hidden="false">
            <div class="brand-logo">AP</div>
            <div>
                <div class="brand-title">API Project</div>
                <div class="brand-sub">Backend · Endpoints</div>
            </div>
        </div>

        <div class="form-title">
            <h2 id="login-heading">Iniciar sesión</h2>
            <p>Accede con tu cuenta para gestionar la API</p>
        </div>

        <form class="login-form" action="javascript:login();" method="POST" autocomplete="on" novalidate>
            <div class="field">
                <label for="email">Correo electrónico</label>
                <input class="input" id="email" name="email" type="email" placeholder="tucorreo@ejemplo.com" required />
            </div>

            <div class="field">
                <label for="password">Contraseña</label>
                <input class="input" id="password" name="password" type="password" placeholder="••••••••" required
                    minlength="6" />
            </div>

            <div class="row">
                <label class="checkbox">
                    <input type="checkbox" name="remember" id="remember" />
                    <span>Recuérdame</span>
                </label>

                <a class="forgot" href="/forgot-password">¿Olvidaste tu contraseña?</a>
            </div>

            <button class="btn" type="submit">Entrar</button>

            <div class="alt">
                ¿No tienes cuenta? <a href="/register">Registrarse</a>
            </div>

            <div class="small">Conexión segura · Responde en JSON desde el backend</div>
        </form>
    </main>
</body>

</html>

<script>
    (
        function() {
            console.log("holas xd")
            if(localStorage.getItem('token')){
                window.location.href = "./dashboard/index.html"
            }
        }
    )();
    async function login() {
        const form = document.querySelector('.login-form');
        const formData = new FormData(form);

        try {
            const response = await fetch("http://127.0.0.1:8000/api/login", {
                method: 'POST',
                body: formData,
                headers: {
                    'Accept': 'application/json'
                }
            });

            const data = await response.json();

            if (response.ok) {
                localStorage.setItem('token', data.token);
                localStorage.setItem('user', JSON.stringify(data.usuario));

                alert('Login exitoso. Bienvenido ' + data.usuario.name);
                window.location.href = './dashboard/index.html';
            } else {
                alert('Error: ' + (data.message || 'Error al iniciar sesión'));
            }

        } catch (error) {
            alert('Error de red: ' + error.message);
        }
    }
</script>